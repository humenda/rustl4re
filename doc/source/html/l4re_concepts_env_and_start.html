<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>L4Re - L4 Runtime Environment: Initial Environment and Application Bootstrapping</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="l4re.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">L4Re - L4 Runtime Environment
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('l4re_concepts_env_and_start.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Initial Environment and Application Bootstrapping </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>New applications that are started by a loader conforming to <a class="el" href="namespaceL4Re.html" title="L4Re C++ Interfaces. ">L4Re</a> get provided an <a class="el" href="group__api__l4re__env.html">Initial Environment</a>.</p>
<p>This environment comprises a set of capabilities to initial <a class="el" href="namespaceL4Re.html" title="L4Re C++ Interfaces. ">L4Re</a> objects that are required to bootstrap and run this application. These capabilities include:</p>
<ul>
<li>A capability to an initial memory allocator for obtaining memory in the form of data spaces</li>
<li>A capability to a factory which can be used to create additional kernel objects</li>
<li>A capability to a Vcon object for debugging output and maybe input</li>
<li>A set of named capabilities to application specific objects</li>
</ul>
<p>During the bootstrapping of the application, the loader establishes data spaces for each individual region in the ELF binary. These include data spaces for the code and data sections, and a data space backed with RAM for the stack of the program's first thread.</p>
<p>One loader implementation is the <code>moe</code> root task. Moe usually starts an <em>init</em> process that is responsible for coordinating the further boot process. The default <em>init</em> process is <code>ned</code>, which implements a script-based configuration and startup of other processes. Ned uses Lua (<a href="http://www.lua.org">http://www.lua.org</a>) as its scripting language, see <a class="el" href="l4re_servers_ned.html">Ned Script example</a> for more details.</p>
<h1><a class="anchor" id="l4re_ns_config"></a>
Configuring an application before startup</h1>
<p>The default <a class="el" href="namespaceL4Re.html" title="L4Re C++ Interfaces. ">L4Re</a> init process (Ned) provides a Lua script based configuration of initial capabilities and application startup. Ned itself also has a set of initial objects available that can be used to create the environment for an application. The most important object is a kernel object factory that allows creation of kernel objects such as IPC gates (communication channels), tasks, threads, etc. Ned uses Lua tables (associative arrays) to represent sets of capabilities that shall be granted to application processes. </p><div class="fragment"><div class="line">local caps = {</div><div class="line">    name = some_capability</div><div class="line">}</div></div><!-- fragment --><p> The <a class="el" href="namespaceL4.html" title="L4 low-level kernel interface. ">L4</a> Lua package in Ned also has support functions to create application tasks, region-map objects, etc. to start an ELF binary in a new task. The package also contains Lua bindings for basic <a class="el" href="namespaceL4Re.html" title="L4Re C++ Interfaces. ">L4Re</a> objects, for example, to generic factory objects, which are used to create kernel objects and also user-level objects provided by user-level servers. </p><div class="fragment"><div class="line">L4.default_loader:start({ caps = { some_service = service } }, <span class="stringliteral">&quot;rom/program --arg&quot;</span>);</div></div><!-- fragment --><h1><a class="anchor" id="l4re_config_connection"></a>
Connecting clients and servers</h1>
<p>In general, a connection between a client and a server is represented by a communication channel (IPC gate). That is available to the client and the server. You can see the simplest connection between a client and a server in the following example. </p><div class="fragment"><div class="line">local loader = L4.default_loader; -- which is Moe</div><div class="line">local svc = loader:new_channel();  -- create an IPC gate</div><div class="line">loader:start({ caps = { service = svc:svr() }}, <span class="stringliteral">&quot;rom/my_server&quot;</span>);</div><div class="line">loader:start({ caps = { service = svc:m(<span class="stringliteral">&quot;rw&quot;</span>) }}, <span class="stringliteral">&quot;rom/my_client&quot;</span>);</div></div><!-- fragment --><p> As you can see in the snippet, the first action is to create a new channel (IPC gate) using <code>loader:new_channel()</code>. The capability to the gate is stored in the variable <code>svc</code>. Then the binary <code>my_server</code> is started in a new task, and full (<code>:svr()</code>) access to the IPC gate is granted to the server as initial object. The gate is accessible to the server application as "service" in the set of its initial capabilities. Virtually in parallel a second task, running the client application, is started and also given access to the IPC gate with less rights (<code>:m("rw")</code>, note, this is essential). The server can now receive messages via the IPC gate and provide some service and the client can call operations on the IPC gate to communicate with the server.</p>
<p>Services that keep client specific state need to implement per-client server objects. Usually it is the responsibility of some authority (e.g., Ned) to request such an object from the service via a generic factory object that the service provides initially. </p><div class="fragment"><div class="line">local loader = L4.default_loader; -- which is Moe</div><div class="line">local svc = loader:new_channel():m(<span class="stringliteral">&quot;rws&quot;</span>);  -- create an IPC gate with rws rights</div><div class="line">loader:start({ caps = { service = svc:svr() } }, <span class="stringliteral">&quot;rom/my-service&quot;</span>);</div><div class="line">loader:start({ caps = { foo_service = svc:create(object_to_create, <span class="stringliteral">&quot;param&quot;</span>) }}, <span class="stringliteral">&quot;rom/client&quot;</span>);</div></div><!-- fragment --><p> This example is quite similar to the first one, however, the difference is that Ned itself calls the create method on the factory object provided by the server and passes the returned capability of that request as "foo_service" to the client process.</p>
<dl class="section note"><dt>Note</dt><dd>The <code>svc:create(..)</code> call blocks on the server. This means the script execution blocks until the my-service application handles the create request. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="l4re_concepts.html">Programming for L4Re</a></li>
    <li class="footer">Generated on Mon Jul 23 2018 07:54:19 for L4Re - L4 Runtime Environment by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
